<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—É–ª—å—Ç –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <style>
        @keyframes pulse { 0% { transform: scale(1); opacity: .8; } 50% { transform: scale(1.15); opacity: 1; } 100% { transform: scale(1); opacity: .8; } }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; background-color: #121212; color: #e0e0e0; margin: 0; text-align: center; overflow-y: auto; }
        .main-content { padding: 20px 0; }
        .container { display: flex; justify-content: space-around; width: 95%; }
        .player { width: 45%; }
        input[type="text"] { background-color: #333; color: #fff; border: none; font-size: 5vw; width: 100%; text-align: center; margin-bottom: 5px; padding: 10px; border-radius: 8px; transition: background-color 0.3s ease; }
        .score { font-size: 18vw; font-weight: 700; line-height: 1; cursor: pointer; user-select: none; color: #4CAF50; }
        .sets { font-size: 5vw; font-weight: 700; margin-top: 15px; color: #FFC107; }
        .serve-indicator { font-size: 4vw; height: 5vw; margin-top: 15px; user-select: none; }
        .serve-active { animation: pulse 2s infinite ease-in-out; }
        button { background-color: #555; color: #fff; border: none; padding: 10px 20px; font-size: 1.2vw; cursor: pointer; margin: 5px; border-radius: 8px; }
        button:hover { background-color: #777; }
        .divider { width: 1px; background-color: #555; }
        .controls-footer {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            width: 100%; /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ó–∞–¥–∞–µ–º —à–∏—Ä–∏–Ω—É */
            justify-content: center; /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
        }
        .server-select-container { margin-bottom: 15px; }
        .server-select-container h3 { font-size: 1.5vw; margin: 5px 0; }
        .server-select-container button { padding: 8px 15px; font-size: 1vw; color: #e0e0e0; border: 1px solid #777; }
        .server-select-container button.selected { background-color: #4CAF50; box-shadow: 0 0 10px #4CAF50; border-color: #4CAF50; }
        .player-select { width: 100%; padding: 8px; background-color: #333; color: white; border-radius: 5px; border: 1px solid #555; font-size: 1.2vw; margin-bottom: 20px; }
        .db-management { border: 1px solid #444; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
        .db-management h3 { margin: 0 0 10px 0; font-size: 1.5vw; }
        .db-management input { font-size: 1.2vw; width: 200px; padding: 8px; }
        .db-management button { font-size: 1.2vw; }
        .history-container { margin-top: 25px; border-top: 1px solid #444; padding-top: 15px; width: 80%; }
        .history-container h3 { font-size: 1.5vw; }
        .history-list { display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 1.5vw; font-weight: bold; }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="db-management">
            <h3>–ë–∞–∑–∞ –∏–≥—Ä–æ–∫–æ–≤</h3>
            <input type="text" id="newPlayerName" placeholder="–ò–º—è –§–∞–º–∏–ª–∏—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞">
            <button onclick="addPlayer()">–î–æ–±–∞–≤–∏—Ç—å</button>
            <button onclick="clearPlayers()">–û—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        </div>
        <div class="server-select-container"><h3>–ö—Ç–æ –ø–æ–¥–∞–µ—Ç –ø–µ—Ä–≤—ã–º?</h3><button onclick="setInitialServer(1)" id="serverBtn1">–ò–≥—Ä–æ–∫ 1</button><button onclick="setInitialServer(2)" id="serverBtn2">–ò–≥—Ä–æ–∫ 2</button></div>
        <div class="container">
            <div class="player" id="player1"><input type="text" placeholder="–ò–≥—Ä–æ–∫ 1" id="name1"><select class="player-select" id="player1-select" onchange="selectPlayer(1, this.value)" onclick="event.stopPropagation()"></select><div class="score" onclick="addPoint(1)">0</div><div class="sets">–°–µ—Ç—ã: 0</div><div class="serve-indicator" id="serve1">üèì</div><button onclick="removePoint(1)">-1 –û—á–∫–æ</button><button onclick="addSet(1)">+1 –°–µ—Ç</button><button onclick="removeSet(1)">-1 –°–µ—Ç</button></div>
            <div class="divider"></div>
            <div class="player" id="player2"><input type="text" placeholder="–ò–≥—Ä–æ–∫ 2" id="name2"><select class="player-select" id="player2-select" onchange="selectPlayer(2, this.value)" onclick="event.stopPropagation()"></select><div class="score" onclick="addPoint(2)">0</div><div class="sets">–°–µ—Ç—ã: 0</div><div class="serve-indicator" id="serve2"></div><button onclick="removePoint(2)">-1 –û—á–∫–æ</button><button onclick="addSet(2)">+1 –°–µ—Ç</button><button onclick="removeSet(2)">-1 –°–µ—Ç</button></div>
        </div>
        <div class="controls-footer"><button onclick="resetScore()">–°–±—Ä–æ—Å–∏—Ç—å —Å—á–µ—Ç</button><button onclick="resetGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button><button onclick="swapColors()">–ü–æ–º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç–∞</button></div>
        <div class="history-container">
            <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–∞—Ä—Ç–∏–π</h3>
            <div id="historyList" class="history-list"></div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script>
        (function() { const p = "886622"; const e = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—É–ª—å—Ç—É:", ""); if (e !== p) { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å."); document.body.innerHTML = '<h1>–î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù</h1>'; throw new Error("Access Denied"); } })();
        const firebaseConfig = {
  apiKey: "AIzaSyDTxZWC9Txxg4hHkpMkKOoq6eyZ-QHlCt4",
  authDomain: "gtr-cup-court-2.firebaseapp.com",
  projectId: "gtr-cup-court-2",
  storageBucket: "gtr-cup-court-2.firebasestorage.app",
  messagingSenderId: "5588116973",
  appId: "1:5588116973:web:f0c9ef08514426b2e633e4"
};
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const urlParams = new URLSearchParams(window.location.search);
        const tableId = urlParams.get('table') || '1';
        const firebasePath = `gameState_Table${tableId}`;
        const stateRef = database.ref(firebasePath);
        let gameState = null;
        const scoreEls=[document.querySelector("#player1 .score"),document.querySelector("#player2 .score")],setEls=[document.querySelector("#player1 .sets"),document.querySelector("#player2 .sets")],serveEls=[document.getElementById("serve1"),document.getElementById("serve2")],nameInputs=[document.getElementById("name1"),document.getElementById("name2")],serverBtns=[document.getElementById("serverBtn1"),document.getElementById("serverBtn2")];
        const playerSelects = [document.getElementById('player1-select'), document.getElementById('player2-select')];
        const newPlayerNameInput = document.getElementById('newPlayerName');
        const historyListEl = document.getElementById('historyList');
        let playerDB = [];
        function loadPlayers() { const db = localStorage.getItem('playerDatabase'); playerDB = db ? JSON.parse(db) : []; playerSelects.forEach(select => { select.innerHTML = '<option value="">-- –í—ã–±—Ä–∞—Ç—å –∏–≥—Ä–æ–∫–∞ --</option>'; playerDB.forEach(player => { const option = document.createElement('option'); option.value = player; option.textContent = player; select.appendChild(option); }); }); }
        function savePlayers() { localStorage.setItem('playerDatabase', JSON.stringify(playerDB)); }
        function addPlayer() { const newName = newPlayerNameInput.value.trim(); if (newName && !playerDB.includes(newName)) { playerDB.push(newName); playerDB.sort(); savePlayers(); loadPlayers(); newPlayerNameInput.value = ''; } }
        function clearPlayers() { if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã?')) { playerDB = []; savePlayers(); loadPlayers(); } }
        function selectPlayer(playerIndex, name) { if (name) { nameInputs[playerIndex - 1].value = name; nameInputs[playerIndex - 1].dispatchEvent(new Event('input')); } }
        nameInputs[0].oninput=()=>{if(!gameState)return;gameState.names[0]=nameInputs[0].value||"–ò–≥—Ä–æ–∫ 1",serverBtns[0].textContent=gameState.names[0],saveState()},nameInputs[1].oninput=()=>{if(!gameState)return;gameState.names[1]=nameInputs[1].value||"–ò–≥—Ä–æ–∫ 2",serverBtns[1].textContent=gameState.names[1],saveState()};
        function saveState(){if(gameState)stateRef.set(gameState)}function setInitialServer(e){if(!gameState)return;gameState.initialServer=e,gameState.server=e,saveState()}function addPoint(e){if(!gameState)return;gameState.scores[e-1]++,checkGameEnd(),saveState()}function removePoint(e){if(!gameState||gameState.scores[e-1]<=0)return;gameState.scores[e-1]--,saveState()}function addSet(e){if(!gameState)return;gameState.sets[e-1]++,saveState()}function removeSet(e){if(!gameState||gameState.sets[e-1]<=0)return;gameState.sets[e-1]--,saveState()}
        function swapColors(){if(!gameState)return;gameState.colorAssignment=gameState.colorAssignment==="swapped"?"default":"swapped",saveState()}
        function checkGameEnd(){if(!gameState)return;const[e,t]=gameState.scores;if(e>=11&&e-t>=2||t>=11&&t-e>=2){gameState.sets[e>t?0:1]++,gameState.gameHistory.push({p1:e,p2:t}),gameState.scores=[0,0],gameState.initialServer=1===gameState.initialServer?2:1}}
        function updateServe(){if(!gameState)return;const e=gameState.scores[0],t=gameState.scores[1],a=e+t,o=1===gameState.initialServer?2:1;if(e>=10&&t>=10){const e=a-20,t=0==Math.floor(20/2)%2?gameState.initialServer:o;gameState.server=0==e%2?t:1===t?2:1}else{const e=Math.floor(a/2);gameState.server=0==e%2?gameState.initialServer:o}}
        function updateDisplay(e){const t={scores:[0,0],sets:[0,0],server:1,initialServer:1,names:["–ò–≥—Ä–æ–∫ 1","–ò–≥—Ä–æ–∫ 2"],gameHistory:[],colorAssignment:"default"};gameState={...t,...e},updateServe(),scoreEls[0].textContent=gameState.scores[0],scoreEls[1].textContent=gameState.scores[1],setEls[0].textContent="–°–µ—Ç—ã: "+gameState.sets[0],setEls[1].textContent="–°–µ—Ç—ã: "+gameState.sets[1],nameInputs[0].value=gameState.names[0],nameInputs[1].value=gameState.names[1],serverBtns[0].textContent=gameState.names[0],serverBtns[1].textContent=gameState.names[1],serverBtns[0].classList.toggle("selected",1===gameState.initialServer),serverBtns[1].classList.toggle("selected",2===gameState.initialServer),serveEls[0].textContent=1===gameState.server?"üèì":"",serveEls[1].textContent=2===gameState.server?"üèì":"",serveEls[0].classList.toggle("serve-active",1===gameState.server),serveEls[1].classList.toggle("serve-active",2===gameState.server);const a="#000000",o="#20B2AA",n="#FFFFFF",s="#000000";"swapped"===gameState.colorAssignment?(nameInputs[0].style.backgroundColor=o,nameInputs[0].style.color=s,nameInputs[1].style.backgroundColor=a,nameInputs[1].style.color=n):(nameInputs[0].style.backgroundColor=a,nameInputs[0].style.color=n,nameInputs[1].style.backgroundColor=o,nameInputs[1].style.color=s);
            historyListEl.innerHTML = '';
            if (gameState.gameHistory && gameState.gameHistory.length > 0) {
                gameState.gameHistory.forEach(game => {
                    const gameEl = document.createElement('div');
                    gameEl.textContent = `${game.p1} - ${game.p2}`;
                    historyListEl.appendChild(gameEl);
                });
            }
        }
        function resetGame(){const e={scores:[0,0],sets:[0,0],server:1,initialServer:1,names:["–ò–≥—Ä–æ–∫ 1","–ò–≥—Ä–æ–∫ 2"],gameHistory:[],colorAssignment:"default"};stateRef.set(e)}function resetScore(){if(!gameState)return;gameState.scores=[0,0],gameState.server=gameState.initialServer,saveState()}stateRef.on("value",e=>{updateDisplay(e.val())});
        
        document.addEventListener('DOMContentLoaded', loadPlayers);
    </script>
</body>
</html>
