<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>OBS Табло v2</title>
    <style>
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        html, body { margin: 0; padding: 0; background-color: transparent; font-family: 'Segoe UI', Arial, sans-serif; user-select: none; color: white; }
        .obs-stack-container { display: flex; flex-direction: column; gap: 8px; }
        .player-bar { box-sizing: border-box; display: flex; align-items: center; padding: 0 10px; height: 50px; width: 450px; border-radius: 25px; font-weight: bold; }
        
        /* Цвета теперь задаются через переменные, которыми управляет JS */
        #player1 { background-color: var(--p1-color, #000000); }
        #player2 { background-color: var(--p2-color, #20B2AA); }

        .serve-indicator { width: 30px; height: 30px; background-color: #FFFFFF; border-radius: 50%; margin-right: 10px; visibility: hidden; }
        .serve-active { visibility: visible; animation: pulse 1.5s infinite ease-in-out; }
        .name { font-size: 24px; flex-grow: 1; }
        .sets { width: 36px; height: 36px; border: 2px solid white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 22px; margin-right: 8px; }
        .score { width: 40px; height: 40px; background-color: #17a365; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 26px; }
    </style>
</head>
<body>
    <div class="obs-stack-container">
        <div class="player-bar" id="player1"><div class="serve-indicator"></div><div class="name">Игрок 1</div><div class="sets">0</div><div class="score">0</div></div>
        <div class="player-bar" id="player2"><div class="serve-indicator"></div><div class="name">Игрок 2</div><div class="sets">0</div><div class="score">0</div></div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
  apiKey: "AIzaSyDTxZWC9Txxg4hHkpMkKOoq6eyZ-QHlCt4",
  authDomain: "gtr-cup-court-2.firebaseapp.com",
  projectId: "gtr-cup-court-2",
  storageBucket: "gtr-cup-court-2.firebasestorage.app",
  messagingSenderId: "5588116973",
  appId: "1:5588116973:web:f0c9ef08514426b2e633e4"
};
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const urlParams = new URLSearchParams(window.location.search);
        const tableId = urlParams.get('table') || '1';
        const firebasePath = `gameState_Table${tableId}`;
        const stateRef = database.ref(firebasePath);

        const scoreEls=[document.querySelector("#player1 .score"),document.querySelector("#player2 .score")],setEls=[document.querySelector("#player1 .sets"),document.querySelector("#player2 .sets")],serveEls=[document.querySelector("#player1 .serve-indicator"),document.querySelector("#player2 .serve-indicator")],nameEls=[document.querySelector("#player1 .name"),document.querySelector("#player2 .name")];
        
        function updateDisplay(state) {
            const defaultState = {scores:[0,0],sets:[0,0],server:1,initialServer:1,names:["Игрок 1","Игрок 2"],gameHistory:[],colorAssignment:"default"};
            const currentState = {...defaultState, ...state};
            
            scoreEls[0].textContent = currentState.scores[0];
            scoreEls[1].textContent = currentState.scores[1];
            setEls[0].textContent = currentState.sets[0];
            setEls[1].textContent = currentState.sets[1];
            nameEls[0].textContent = currentState.names[0];
            nameEls[1].textContent = currentState.names[1];
            serveEls[0].classList.toggle("serve-active", 1 === currentState.server);
            serveEls[1].classList.toggle("serve-active", 2 === currentState.server);

            // --- НОВАЯ ЛОГИКА СМЕНЫ ЦВЕТОВ ---
            const P1_COLOR = '#000000'; // Черный
            const P2_COLOR = '#20B2AA'; // Бирюзовый
            if (currentState.colorAssignment === 'swapped') {
                document.documentElement.style.setProperty('--p1-color', P2_COLOR);
                document.documentElement.style.setProperty('--p2-color', P1_COLOR);
            } else {
                document.documentElement.style.setProperty('--p1-color', P1_COLOR);
                document.documentElement.style.setProperty('--p2-color', P2_COLOR);
            }
        }
        
        stateRef.on("value", (snapshot) => {
            updateDisplay(snapshot.val());
        });
    </script>
</body>
</html>
